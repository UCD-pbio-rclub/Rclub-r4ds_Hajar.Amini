---
title: "R-club-Jun-14"
author: "Hajar"
date: "June 12, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


#12.2 Tidy data
```{r}
library(tidyverse)
table1 %>% 
  mutate(rate = cases / population * 10000)

table1 %>% 
  count(year, wt = cases)

library(ggplot2)
ggplot(table1, aes(year, cases)) + 
  geom_line(aes(group = country), colour = "grey50") + 
  geom_point(aes(colour = country))
```
#12.2.1 Exercises
1.Using prose, describe how the variables and observations are organised in each of the sample tables.

```{r}
#In table1 each row is a (country, year) with variables cases and population.
table1

#In table2, each row is country, year , variable (“cases”, “population”) combination, and there is a count variable with the numeric value of the variable.
table2

#In table3, each row is a (country, year) combination with the column rate having the rate of cases to population 
table3

#Table 4 is split into two tables, one table for each variable: table4a is the table for cases, while table4b is the table for population. Within each table, each row is a country, each column is a year, and the cells are the value of the variable for the table.

table4a
table4b

```

2.Compute the rate for table2, and table4a + table4b. You will need to perform four operations:
  
1.Extract the number of TB cases per country per year.
2.Extract the matching population per country per year.
3.Divide cases by population, and multiply by 10000.
4.Store back in the appropriate place.
Which representation is easiest to work with? Which is hardest? Why?

```{r}
tb2_cases <- filter(table2, type == "cases")[["count"]]
tb2_country <- filter(table2, type == "cases")[["country"]]
tb2_year <- filter(table2, type == "cases")[["year"]]
tb2_population <- filter(table2, type == "population")[["count"]]
table2_clean <- tibble(country = tb2_country,
       year = tb2_year,
       rate = tb2_cases / tb2_population)
table2_clean
```
3.Recreate the plot showing change in cases over time using table2 instead of table1. What do you need to do first?

```{r}
```

#12.3 Spreading and gathering
12.3.1 Gathering

```{r}
tidy4a <- table4a %>% 
  gather(`1999`, `2000`, key = "year", value = "cases")

tidy4b <- table4b %>% 
  gather(`1999`, `2000`, key = "year", value = "population")

left_join(tidy4a, tidy4b)

```
#12.3.2 Spreading

```{r}
table2
spread(table2, key = type, value = count)
```

#12.3.3 Exercises

1.Why are gather() and spread() not perfectly symmetrical?
Carefully consider the following example:
```{r}
stocks <- tibble(
  year   = c(2015, 2015, 2016, 2016),
  half  = c(   1,    2,     1,    2),
  return = c(1.88, 0.59, 0.92, 0.17)
)
stocks %>% 
  spread(year, return) %>% 
  gather("year", "return", `2015`:`2016`)

#Both spread() and gather() have a convert argument. What does it do?
 
```
2. Why does this code fail?
```{r}
#table4a %>% 
  gather(1999, 2000, key = "year", value = "cases")

```
3.Why does spreading this tibble fail? How could you add a new column to fix the problem?

```{r}
people <- tribble(
  ~name,             ~key,    ~value,
  #-----------------|--------|------
  "Phillip Woods",   "age",       45,
  "Phillip Woods",   "height",   186,
  "Phillip Woods",   "age",       50,
  "Jessica Cordero", "age",       37,
  "Jessica Cordero", "height",   156
)

```
4.Tidy the simple tibble below. Do you need to spread or gather it? What are the variables?

```{r}
preg <- tribble(
  ~pregnant, ~male, ~female,
  "yes",     NA,    10,
  "no",      20,    12
)
```

#12.4 Separating and uniting
#12.4.1 Separate

```{r}
table3
table3 %>% 
  separate(rate, into = c("cases", "population"))

table3 %>% 
  separate(rate, into = c("cases", "population"), sep = "/")

table3 %>% 
  separate(rate, into = c("cases", "population"), convert = TRUE)

table3 %>% 
  separate(year, into = c("century", "year"), sep = 2)


